<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf--8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SUDOKU 스도쿠</title>

  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://sudoku.enjoy-onepage.com/" />
  <meta name="author" content="Sudoku 원페이지" />
  <meta name="description" content="깔끔한 원페이지 스도쿠! 유일해답 보장 퍼즐 생성기 · 난이도별 퍼즐 · 오류 체크 · 해답 보기 · 공유 기능 제공" />
  <meta name="theme-color" content="#f97316" /> <meta property="og:locale" content="ko_KR" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SUDOKU 스도쿠 — 즐겨요 원페이지" />
  <meta property="og:description" content="깔끔한 원페이지 스도쿠! 유일해답 보장 퍼즐 생성기 · 난이도별 퍼즐 · 오류 체크 · 해답 보기 · 공유 기능 제공" />
  <meta property="og:url" content="https://sudoku.enjoy-onepage.com/" />
  <meta property="og:image" content="https://sudoku.enjoy-onepage.com/og-image.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SUDOKU 스도쿠 — 즐겨요 원페이지" />
  <meta name="twitter:description" content="깔끔한 원페이지 스도쿠! 난이도별 퍼즐, 오류 체크, 공유 기능 제공" />
  <meta name="twitter:image" content="https://sudoku.enjoy-onepage.com/og-image.png" />

  <link rel="icon" href="/favicon.ico?v=2" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png?v=2">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png?v=2">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png?v=2" sizes="180x180">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2228289204702106" crossorigin="anonymous"></script>

  <style>
    :root{
      --brand:#f97316; /* 수정: 주황색 */
      --ink:#26160a; /* 수정: 진한 갈색 */
      --muted:#926f5d; /* 수정: 차분한 주황-갈색 */
      --bg:#fff7ed; /* 수정: 연한 주황색 배경 */
      --card:#ffffff;
      --grid:#8f3d0a; /* 수정: 진한 주황-갈색 */
      --error:#fecaca;
      --focus:#fdbd8c; /* 수정: 연한 주황색 */
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;height:100%;background:var(--bg);color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo",Arial;
      overflow-x:hidden;
    }
    .container{max-width:980px;margin:0 auto;padding:16px}
    .header{background:var(--brand);color:#fff;border-radius:var(--radius);padding:18px; position:relative}
    .header h1{margin:0;font-size:1.6rem;line-height:1.2;font-weight:900;letter-spacing:.02em}
    .header-sub{margin-top:6px;color:#ffedd5; /* 수정: 헤더 서브텍스트 색상 */ font-size:.95rem}
    .header-buttons{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:0;border-radius:999px;padding:10px 14px;font-weight:700;white-space:nowrap;
      background:#fff;color:#ea580c; /* 수정: 버튼 텍스트 색상 */ box-shadow:0 1px 0 rgba(0,0,0,.06);cursor:pointer
    }
    .btn.secondary{background:#fcd3b2; /* 수정: 보조 버튼 배경색 */ color:#c2410c; /* 수정: 보조 버튼 텍스트 색상 */}
    .btn.ghost{background:#ffffffd9}
    .share-menu-wrap{position:relative}
    .share-menu{
      position:absolute; top:105%; left:0; background:#fff; border:1px solid #e2e8f0; border-radius:12px;
      box-shadow:0 8px 24px rgba(2,6,23,.15); padding:6px; display:none; z-index:20; min-width:160px;
      max-width:100%;
    }
    .share-menu button{display:block; width:100%; text-align:left; border-radius:10px; border:0; padding:10px 12px; background:#fff; cursor:pointer}
    .share-menu button:hover{background:#fefce8; /* 수정: 공유 메뉴 호버 색상 */}
    .controls{margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .controls label{font-weight:700}
    select{border:1px solid #cbd5e1;border-radius:10px;padding:10px 12px;background:#fff;font-weight:600;max-width:100%}
    .actions{margin-top:8px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .btn.control{border:1px solid #cbd5e1;background:#fff;color:#c2410c; /* 수정: 컨트롤 버튼 텍스트 색상 */ border-radius:10px;width:100%}
    .wrap{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    .board-card,.info-card{background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:0 2px 10px rgba(2,6,23,.06)}
    .board{
      width:min(100%,520px);
      aspect-ratio:1;margin:8px auto;border:3px solid var(--grid);
      border-radius:10px;display:grid;grid-template-columns:repeat(9,1fr);grid-template-rows:repeat(9,1fr);overflow:hidden;background:#fff
    }
    .cell{border:1px solid #cbd5e1;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1.2rem;user-select:none;}
    .cell.given{background:#fef2e8; /* 수정: 초기 숫자 칸 배경색 */ color:var(--ink)}
    .cell.editable{cursor:pointer}
    .cell.selected{outline:3px solid var(--focus);z-index:2;position:relative}
    .cell.same{background:#ffeacb; /* 수정: 같은 숫자 칸 배경색 */}
    .cell.error{background:var(--error)}
    .cell.marked{background:#fef9c3}
    .cell[data-r="0"],.cell[data-r="3"],.cell[data-r="6"]{border-top:3px solid var(--grid)}
    .cell[data-c="0"],.cell[data-c="3"],.cell[data-c="6"]{border-left:3px solid var(--grid)}
    .cell[data-r="8"]{border-bottom:3px solid var(--grid)}
    .cell[data-c="8"]{border-right:3px solid var(--grid)}
    .pad{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;max-width:520px;margin:0 auto;padding:0 2px}
    .pad button{padding:14px 0;border-radius:14px;border:1px solid #cbd5e1;background:#fff;font-weight:900;font-size:1.15rem;cursor:pointer}
    .pad .erase{grid-column:span 2}
    .pad button:active{transform:translateY(1px)}
    .info{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .tile{background:#fff7ed; /* 수정: 정보 타일 배경색 */ border:1px solid #fed7aa; /* 수정: 정보 타일 보더색 */ padding:10px;text-align:center}
    .tile .k{color:var(--muted);font-size:.9rem}
    .tile .v{font-size:1.15rem;font-weight:900;margin-top:6px}
    
    .memo-pad{max-width:520px; margin:0 auto 8px; padding:0 10px 10px; display:grid; grid-template-columns:repeat(9, 1fr); gap:8px;}
    .memo-pad button{border:0; background:#fff; border-radius:10px; padding:10px 0; font-weight:700; cursor:pointer; box-shadow:0 1px 0 rgba(0,0,0,.06);}
    .memo-pad button.selected{background:var(--brand); color:#fff;}
    .pad-label {text-align:center; font-size:0.9rem; font-weight:600; color:var(--muted); padding:16px 0 8px;}

    @media (max-width:600px){
      html{font-size:18px}
      .header h1{font-size:1.35rem}
      .btn,select,.btn.control{font-size:1rem}
      .pad button{font-size:1.25rem;padding:16px 0}
      .info{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:380px){
      .actions{grid-template-columns:1fr;}
    }
    @media (max-width:480px){
      .pad{gap:8px}
      .memo-pad{gap:6px} 
      .memo-pad button{font-size:1rem; padding:12px 0;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>SUDOKU 스도쿠</h1>
      <div class="header-sub">깔끔한 스도쿠 · 유일해답 보장 생성기 · 오프라인에서도 부드럽게</div>

      <div class="header-buttons">
        <div class="share-menu-wrap">
          <button class="btn secondary" id="btn-share-open">공유</button>
          <div id="share-menu" class="share-menu" aria-label="공유 옵션">
            <button id="btn-kakao">카카오톡 공유</button>
            <button id="btn-system">시스템 공유</button>
          </div>
        </div>
        <button class="btn ghost" id="btn-copy">URL 복사</button>
      </div>
    </header>

    <ins class="adsbygoogle"
         style="display:block; text-align:center; margin:10px auto; width:100%;"
         data-ad-client="ca-pub-2228289204702106"
         data-ad-slot="7464033680"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>try{(adsbygoogle=window.adsbygoogle||[]).push({});}catch(e){}</script>

    <section class="controls">
      <label for="difficulty">난이도</label>
      <select id="difficulty" title="난이도">
        <option value="easy">쉬움</option>
        <option value="normal" selected>보통</option>
        <option value="hard">어려움</option>
      </select>
      <strong id="info-diff" style="margin-left:4px;color:var(--ink)">보통</strong> </section>

    <section class="actions">
      <button class="btn control" id="btn-new">새 퍼즐</button>
      <button class="btn control" id="btn-check">오류 체크</button>
      <button class="btn control" id="btn-solve">해답 보기</button>
      <button class="btn control" id="btn-reset">초기화</button>
      <button class="btn control" id="btn-mark">칸 표시/해제</button>
    </section>

    <div class="wrap">
      <div class="board-card">
        <div id="board" class="board" aria-label="스도쿠 보드" role="grid"></div>

        <div id="memo-pad-area" style="display:none;">
            <div class="pad-label">후보 메모</div>
            <div id="memo-pad" class="memo-pad" aria-label="후보 숫자 메모"></div>
        </div>

        <div class="pad-label">정답입력 키패드</div>
        <div id="pad" class="pad" aria-label="숫자 패드"></div>
      </div>

      <ins class="adsbygoogle"
           style="display:block; text-align:center; margin:8px auto; max-width:520px"
           data-ad-client="ca-pub-2228289204702106"
           data-ad-slot="6150952012"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>try{(adsbygoogle=window.adsbygoogle||[]).push({});}catch(e){}</script>

      <div class="info-card">
        <div class="info">
          <div class="tile"><div class="k">타이머</div><div class="v" id="info-time">00:00</div></div>
          <div class="tile"><div class="k">남은 칸</div><div class="v" id="info-empty">0</div></div>
          <div class="tile"><div class="k">오류 수</div><div class="v" id="info-errors">0</div></div>
          <div class="tile"><div class="k">상태</div><div class="v" id="info-state">진행 중</div></div>
        </div>
        <div id="result-share-area" style="display:none; text-align:center; margin-top:12px;">
          <button id="btn-share-result" class="btn secondary">🏆 카카오톡으로 결과 공유</button>
        </div>
      </div>

      <ins class="adsbygoogle"
           style="display:block; text-align:center; margin:8px auto; width:100%"
           data-ad-client="ca-pub-2228289204702106"
           data-ad-slot="3524788673"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>try{(adsbygoogle=window.adsbygoogle||[]).push({});}catch(e){}</script>
    </div>

    <p style="color:#94a3b8;text-align:center;margin:24px 0 8px">© 2025 sudoku.enjoy-onepage.com</p>
  </div>

  <script>
    /* ========= 설정 ========= */
    const KAKAO_APP_KEY = '71609bac6893282ede3cda73ae054b52';

    /* ========= 유틸 ========= */
    const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
    const deepCopy=b=>b.map(r=>r.slice());

    /* ========= 상태 ========= */
    let solution=[...Array(9)].map(()=>Array(9).fill(0));
    let puzzle=[...Array(9)].map(()=>Array(9).fill(0));
    let state=[...Array(9)].map(()=>Array(9).fill(0));
    let given=[...Array(9)].map(()=>Array(9).fill(false));
    let marked=[...Array(9)].map(()=>Array(9).fill(false));
    let memos = [...Array(9)].map(() => [...Array(9)].map(() => new Set()));
    let selected={r:null,c:null};
    let timer=0,timerId=null,mistakes=0;
    let revealed=false;
    let finalClearTime = null, finalDifficulty = null;

    /* ========= 보드 ========= */
    const boardEl=document.getElementById('board');
    function buildBoard(){
      boardEl.innerHTML='';
      for(let r=0;r<9;r++){
        for(let c=0;c<9;c++){
          const d=document.createElement('div');
          d.className='cell'; d.dataset.r=r; d.dataset.c=c;
          d.addEventListener('click',()=>selectCell(r,c));
          d.setAttribute('role','gridcell');
          d.setAttribute('tabindex','0');
          boardEl.appendChild(d);
        }
      }
    }

    // renderBoard 함수 (메모 표시는 제거)
    function renderBoard(){
      let empty=0;
      [...boardEl.children].forEach(cell=>{
        const r=+cell.dataset.r,c=+cell.dataset.c,v=state[r][c];
        
        // 셀의 숫자 내용을 간단하게 표시
        cell.textContent = v ? v : '';
        
        // 클래스 목록 관리
        cell.classList.remove('given','editable','selected','same','error','marked');
        if(given[r][c]){ cell.classList.add('given'); cell.setAttribute('tabindex','-1'); }
        else { cell.classList.add('editable'); cell.setAttribute('tabindex','0'); }
        if(marked[r][c]) cell.classList.add('marked');
        if(selected.r===r && selected.c===c) cell.classList.add('selected');
        if(v && selected.r!==null && state[selected.r][selected.c]===v) cell.classList.add('same');
        if(!v) empty++;
      });
      document.getElementById('info-empty').textContent=empty;
      document.getElementById('info-errors').textContent=mistakes;
    }

    function selectCell(r,c){ 
        selected={r,c};
        renderBoard(); 
        renderMemoPad();
    }

    /* ========= 숫자패드 & 메모패드 ========= */
    const padEl=document.getElementById('pad');
    const memoPadAreaEl = document.getElementById('memo-pad-area');
    const memoPadEl = document.getElementById('memo-pad');

    function buildPad(){
      padEl.innerHTML='';
      for(let n=1;n<=9;n++){
        const b=document.createElement('button'); b.textContent=n; b.addEventListener('click',()=>place(n));
        padEl.appendChild(b);
      }
      const e=document.createElement('button'); e.textContent='지우기'; e.className='erase'; e.addEventListener('click',()=>place(0));
      padEl.appendChild(e);
    }
    function place(n){
      const {r,c}=selected; if(r===null||given[r][c]) return;
      state[r][c]=n||0;
      renderBoard();
      renderMemoPad();
      checkWin();
    }
    
    function buildMemoPad() {
        memoPadEl.innerHTML = '';
        for (let n = 1; n <= 9; n++) {
            const b = document.createElement('button');
            b.textContent = n;
            b.addEventListener('click', () => toggleMemo(n));
            memoPadEl.appendChild(b);
        }
    }
    function renderMemoPad() {
        const { r, c } = selected;
        if (r === null || c === null || given[r][c]) {
            memoPadAreaEl.style.display = 'none';
            return;
        }
        memoPadAreaEl.style.display = 'block';
        const currentMemos = memos[r][c];
        [...memoPadEl.children].forEach((btn, i) => {
            const n = i + 1;
            if (currentMemos.has(n)) {
                btn.classList.add('selected');
            } else {
                btn.classList.remove('selected');
            }
        });
    }
    function toggleMemo(n) {
        const { r, c } = selected;
        if (r === null || c === null || given[r][c]) return;
        
        if (memos[r][c].has(n)) {
            memos[r][c].delete(n);
        } else {
            memos[r][c].add(n);
        }
        renderMemoPad();
    }

    /* ========= 타이머 ========= */
    function startTimer(){ stopTimer(); timer=0;
      timerId=setInterval(()=>{timer++;const m=String(Math.floor(timer/60)).padStart(2,'0');const s=String(timer%60).padStart(2,'0');
        document.getElementById('info-time').textContent=`${m}:${s}`;},1000);}
    function stopTimer(){ if(timerId){clearInterval(timerId); timerId=null;} }

    /* ========= 스도쿠 로직 ========= */
    function valid(b,r,c,v){
      for(let i=0;i<9;i++){ if(b[r][i]===v||b[i][c]===v) return false; }
      const br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
      for(let i=0;i<3;i++)for(let j=0;j<3;j++) if(b[br+i][bc+j]===v) return false;
      return true;
    }
    function solveCount(board,limit=2){
      let cnt = 0;
      const b = deepCopy(board);
      function nextCell(){
        let best=null, bestCands=null;
        for(let r=0;r<9;r++){
          for(let c=0;c<9;c++){
            if(b[r][c]!==0) continue;
            const cands=[];
            for(let v=1; v<=9; v++) if(valid(b,r,c,v)) cands.push(v);
            if(cands.length===0) return {r,c,cands:[]};
            if(bestCands===null || cands.length<bestCands.length){
              best={r,c,cands}; bestCands=cands;
              if(cands.length===1) return best;
            }
          }
        }
        return best;
      }
      function dfs(){
        if(cnt>=limit) return;
        const cell=nextCell();
        if(!cell){ cnt++; return; }
        if(cell.cands.length===0) return;
        shuffle(cell.cands);
        const {r,c,cands}=cell;
        for(const v of cands){
          b[r][c]=v; dfs(); b[r][c]=0;
          if(cnt>=limit) return;
        }
      }
      dfs();
      return cnt;
    }
    function generateFull(){
      const b=[...Array(9)].map(()=>Array(9).fill(0));
      function fill(idx=0){
        if(idx===81) return true;
        const r=Math.floor(idx/9),c=idx%9,nums=shuffle([1,2,3,4,5,6,7,8,9]);
        for(const v of nums){ if(valid(b,r,c,v)){ b[r][c]=v; if(fill(idx+1)) return true; b[r][c]=0; } }
        return false;
      }
      fill(0); return b;
    }
    function makePuzzle(full,diff='normal'){
      const holeRangesByDiff = { easy: [35, 41], normal: [43, 49], hard: [51, 57] };
      const [lo,hi]=holeRangesByDiff[diff]||holeRangesByDiff.normal;
      const targetHoles = rand(lo,hi);
      const p=deepCopy(full);
      const pos=[]; for(let r=0;r<9;r++)for(let c=0;c<9;c++) pos.push([r,c]);
      shuffle(pos);
      let removed=0;
      for(const [r,c] of pos){
        if(removed>=targetHoles) break;
        const bak=p[r][c]; p[r][c]=0;
        if(solveCount(p,2)!==1){ p[r][c]=bak; continue; }
        removed++;
      }
      return p;
    }
    function highlightErrors(){
      const errorIdx = new Set();
      [...boardEl.children].forEach(cell=>cell.classList.remove('error'));
      for(let r=0;r<9;r++){
        for(let c=0;c<9;c++){
          const v=state[r][c]; if(!v) continue;
          for(let cc=0;cc<9;cc++){ if(cc!==c && state[r][cc]===v){ errorIdx.add(`${r},${c}`); break; } }
          for(let rr=0;rr<9;rr++){ if(rr!==r && state[rr][c]===v){ errorIdx.add(`${r},${c}`); break; } }
          const br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
          for(let i=0;i<3;i++)for(let j=0;j<3;j++){
            const rr=br+i, cc=bc+j;
            if((rr!==r || cc!==c) && state[rr][cc]===v){ errorIdx.add(`${r},${c}`); i=3; j=3; }
          }
        }
      }
      errorIdx.forEach(key=>{
        const [rr,cc]=key.split(',').map(Number);
        const idx=rr*9+cc;
        boardEl.children[idx]?.classList.add('error');
      });
      mistakes = errorIdx.size;
      document.getElementById('info-errors').textContent=mistakes;
    }

    /* ========= 승리 체크 ========= */
    function checkWin(){
      if(revealed) return;
      for(let r=0;r<9;r++)for(let c=0;c<9;c++){
        if(state[r][c]===0) return;
        if(state[r][c]!==solution[r][c]) return;
      }
      stopTimer();
      document.getElementById('info-state').textContent='클리어! 🎉';
      finalClearTime = timer;
      const diffEl = document.getElementById('difficulty');
      finalDifficulty = diffEl.options[diffEl.selectedIndex].text;
      document.getElementById('result-share-area').style.display = 'block';
    }

    /* ========= 공유 인코딩 ========= */
    function encode(b){return b.flat().join('')}
    function decode(s){const a=[...s].map(ch=>parseInt(ch,10));const b=[...Array(9)].map(()=>Array(9).fill(0));
      for(let i=0;i<81;i++) b[Math.floor(i/9)][i%9]=a[i]||0; return b;}
    function makeShareURL(clearTime = null){
      const u=new URL(location.href);
      u.searchParams.set('p',encode(puzzle));
      u.searchParams.set('s',encode(solution));
      u.searchParams.set('d',document.getElementById('difficulty').value);
      if(clearTime !== null) u.searchParams.set('t', clearTime);
      return u.toString();
    }
    function loadFromShare(u){
      try{
        const url=new URL(u);
        const p=url.searchParams.get('p'); const s=url.searchParams.get('s'); const d=url.searchParams.get('d')||'normal';
        if(!p||!s) return false;
        const puz=decode(p); const sol=decode(s);
        if(puz.length!==9||sol.length!==9) return false;
        puzzle=deepCopy(puz); solution=deepCopy(sol); state=deepCopy(puz);
        given=[...Array(9)].map(()=>Array(9).fill(false));
        for(let r=0;r<9;r++)for(let c=0;c<9;c++) given[r][c]=puzzle[r][c]!==0;
        document.getElementById('difficulty').value=d;
        document.getElementById('info-diff').textContent=(d==='easy'?'쉬움':d==='hard'?'어려움':'보통');
        return true;
      }catch(e){ return false; }
    }

    /* ========= 카카오 공유 ========= */
    let kakaoLoaded=false;
    function loadKakaoSDK(){
      return new Promise((resolve,reject)=>{
        if(kakaoLoaded || window.Kakao){kakaoLoaded=true; return resolve();}
        const s=document.createElement('script');
        s.src='https://developers.kakao.com/sdk/js/kakao.js';
        s.onload=()=>{kakaoLoaded=true; resolve();};
        s.onerror=reject;
        document.head.appendChild(s);
      });
    }
    async function shareSystem(){
      const url = makeShareURL();
      if(navigator.share){
        try{ await navigator.share({title:'스도쿠 퍼즐', text:'같이 풀어봐요!', url}); }
        catch(e){}
      }else{
        await navigator.clipboard.writeText(url);
        alert('공유 링크를 클립보드에 복사했어요!');
      }
      hideShareMenu();
    }
    async function shareKakao(){
      try{
        await loadKakaoSDK();
        if(!window.Kakao) throw new Error('Kakao SDK not available');
        if(!Kakao.isInitialized()){
          if(!KAKAO_APP_KEY) throw new Error('카카오 앱키를 설정하세요.');
          Kakao.init(KAKAO_APP_KEY);
        }
        const url = makeShareURL();
        Kakao.Share.sendDefault({
          objectType: "feed",
          content: {
            title: "SUDOKU 스도쿠 퍼즐",
            description: "깔끔한 원페이지 스도쿠, 지금 풀어보세요!",
            imageUrl: "https://sudoku.enjoy-onepage.com/og-image.png",
            link: { mobileWebUrl: url, webUrl: url }
          },
          buttons: [ { title: "지금 풀기", link: { mobileWebUrl: url, webUrl: url } } ]
        });
      }catch(e){ await shareSystem(); }
      hideShareMenu();
    }
    async function shareResultKakao(){
      const m = String(Math.floor(finalClearTime / 60)).padStart(2, '0');
      const s = String(finalClearTime % 60).padStart(2, '0');
      const timeStr = `${m}:${s}`;
      try{
        await loadKakaoSDK();
        if(!window.Kakao) throw new Error('Kakao SDK not available');
        if(!Kakao.isInitialized()){
          if(!KAKAO_APP_KEY) throw new Error('카카오 앱키를 설정하세요.');
          Kakao.init(KAKAO_APP_KEY);
        }
        const url = makeShareURL(finalClearTime);
        Kakao.Share.sendDefault({
          objectType: "feed",
          content: {
            title: `스도쿠 클리어! (${finalDifficulty})`,
            description: `대단해요! 퍼즐을 ${timeStr} 만에 해결했어요.`,
            imageUrl: "https://sudoku.enjoy-onepage.com/og-image.png",
            link: { mobileWebUrl: url, webUrl: url }
          },
          buttons: [ { title: "같은 문제 풀기", link: { mobileWebUrl: url, webUrl: url } } ]
        });
      }catch(e){ alert('결과 공유에 실패했어요. 링크를 수동으로 복사해 보세요.'); }
    }

    /* ========= 새게임/초기화 ========= */
    function newGame(diff){
      revealed=false;
      document.getElementById('info-diff').textContent=diff==='easy'?'쉬움':diff==='hard'?'어려움':'보통';
      const full=generateFull(); const puz=makePuzzle(full,diff);
      solution=full; puzzle=puz; state=deepCopy(puz);
      marked=[...Array(9)].map(()=>Array(9).fill(false));
      memos = [...Array(9)].map(() => [...Array(9)].map(() => new Set()));
      given=[...Array(9)].map(()=>Array(9).fill(false));
      for(let r=0;r<9;r++)for(let c=0;c<9;c++) given[r][c]=puzzle[r][c]!==0;
      selected={r:null,c:null}; mistakes=0; document.getElementById('info-state').textContent='진행 중';
      finalClearTime = null; finalDifficulty = null;
      document.getElementById('result-share-area').style.display = 'none';
      startTimer(); 
      renderBoard(); 
      renderMemoPad();
      history.replaceState({},'',makeShareURL());
      try{ (adsbygoogle = window.adsbygoogle || []).push({}); }catch(_){}
    }

    /* ========= 이벤트 ========= */
    const shareBtn = document.getElementById('btn-share-open');
    const shareMenu = document.getElementById('share-menu');
    function hideShareMenu(){ shareMenu.style.display='none'; }
    function toggleShareMenu(){ shareMenu.style.display = (shareMenu.style.display==='block' ? 'none' : 'block'); }
    shareBtn.addEventListener('click',toggleShareMenu);
    document.getElementById('btn-kakao').addEventListener('click',shareKakao);
    document.getElementById('btn-system').addEventListener('click',shareSystem);
    document.addEventListener('click',e=>{ if(!e.target.closest('.share-menu-wrap')) hideShareMenu(); });
    document.getElementById('btn-new').addEventListener('click',()=>newGame(document.getElementById('difficulty').value));
    document.getElementById('btn-check').addEventListener('click',highlightErrors);
    document.getElementById('btn-solve').addEventListener('click',()=>{
      revealed = true;
      state = deepCopy(solution);
      memos = [...Array(9)].map(() => [...Array(9)].map(() => new Set()));
      for(let r=0;r<9;r++) for(let c=0;c<9;c++) given[r][c]=true;
      renderBoard();
      renderMemoPad();
      highlightErrors();
      stopTimer();
      document.getElementById('info-state').textContent='해답 표시됨';
    });
    document.getElementById('btn-mark').addEventListener('click', ()=>{
      const {r, c} = selected;
      if (r === null || given[r][c]) return;
      marked[r][c] = !marked[r][c];
      renderBoard();
    });
    document.getElementById('btn-reset').addEventListener('click',()=>{
      revealed = false;
      marked=[...Array(9)].map(()=>Array(9).fill(false));
      memos = [...Array(9)].map(() => [...Array(9)].map(() => new Set()));
      state=deepCopy(puzzle); mistakes=0;
      finalClearTime = null; finalDifficulty = null;
      document.getElementById('result-share-area').style.display = 'none';
      renderBoard();
      renderMemoPad();
      highlightErrors();
      document.getElementById('info-state').textContent='진행 중';
    });
    document.getElementById('btn-copy').addEventListener('click',async()=>{
      await navigator.clipboard.writeText(makeShareURL());
      alert('현재 퍼즐 URL을 복사했어요!');
    });
    document.getElementById('btn-share-result').addEventListener('click', shareResultKakao);
    document.getElementById('difficulty').addEventListener('change',e=>newGame(e.target.value));

    /* ========= 초기 구동 ========= */
    buildBoard(); buildPad();
    buildMemoPad();
    if(!loadFromShare(location.href)){ newGame('normal'); }
    else{
      revealed=false;
      startTimer(); renderBoard();
      history.replaceState({},'',makeShareURL());
      document.getElementById('info-diff').textContent=
        (document.getElementById('difficulty').value==='easy'?'쉬움':
         document.getElementById('difficulty').value==='hard'?'어려움':'보통');
    }

    /* PC 키보드 */
    document.addEventListener('keydown',e=>{
      if(selected.r===null) return;
      if(e.key>='1'&&e.key<='9') place(+e.key);
      if(['Backspace','Delete','0'].includes(e.key)) place(0);
      if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)){
        e.preventDefault();
        const dr=e.key==='ArrowUp'?-1:e.key==='ArrowDown'?1:0;
        const dc=e.key==='ArrowLeft'?-1:e.key==='ArrowRight'?1:0;
        let r=selected.r,c=selected.c;
        r=(r+dr+9)%9; c=(c+dc+9)%9;
        selectCell(r,c);
      }
    });
  </script>
</body>
</html>
